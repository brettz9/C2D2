{"version":3,"file":"c2d2-es.min.js","sources":["../src/c2d2.js"],"sourcesContent":["/* globals require */\n/**\n* @todo Resume ensuring properties/methods are added and any todos noted\n* for potential to accept specific arguments as wrapped objects or\n* return wrapped items: {@link http://www.whatwg.org/specs/web-apps/current-work/multipage/the-canvas-element.html#dfnReturnLink-0}\n* @todo Add tests, including for browser and Node\n*/\n\nlet fs, createCanvas;\nif (typeof require !== 'undefined') {\n  /* eslint-disable global-require */\n  ({createCanvas} = require('canvas'));\n  fs = require('fs');\n  /* eslint-enable global-require */\n}\n\n// Adds NodeJS support, and exports interface to modules\n//   that require this module\n// This should not be needed by Node\nconst win = typeof window === 'undefined' ? global : window;\n\nfunction buildMethod (m) {\n  return function (...args) {\n    this.parent[m](...args);\n    return this;\n  };\n}\nfunction buildGetterMethod (gm, methodFromProperty, WrapperClass) {\n  return function (...args) {\n    const imageData = args[0];\n    if (\n      gm === 'putImageData' && typeof imageData === 'object' &&\n            imageData.imageData\n    ) { // Todo: Hackish check for taking regular ImageData object\n      args[0] = imageData.imageData;\n    }\n    if (methodFromProperty) {\n      return new WrapperClass(this.parent[gm]);\n    }\n    return new WrapperClass(this.parent[gm](...args));\n  };\n}\nfunction buildLiteralGetterMethod (gm) {\n  return function (...args) {\n    return this.parent[gm](...args);\n  };\n}\nfunction buildPropertyMethod (p) {\n  return function (value) {\n    if (value === undefined) {\n      return this.parent[p];\n    }\n    this.parent[p] = value;\n    return this;\n  };\n}\nfunction buildContextMethods (method) {\n  return function (...args) {\n    method.apply(this, args);\n    return this;\n  };\n}\n// Todo: Wrap up any specific methods or properties which might be\n//   used on the opaque pattern and gradient child objects, if ever\n//   exposed, so that these can be properly wrapped and made chainable.\nconst DelegateChain = {\n  addMethods (methods, clss) {\n    for (const method of methods) {\n      clss.prototype[method] = buildMethod(method);\n    }\n  },\n  addGetterMethods (getterMethods, clss, WrapperClass, methodFromProperty) {\n    for (const getterMethod of getterMethods) {\n      if (WrapperClass) {\n        clss.prototype[getterMethod] = buildGetterMethod(\n          getterMethod, methodFromProperty, WrapperClass\n        );\n      } else { // For those which return a literal\n        clss.prototype[getterMethod] = buildLiteralGetterMethod(\n          getterMethod\n        );\n      }\n    }\n  },\n  addPropertyMethods (props, clss) {\n    for (const prop of props) {\n      clss.prototype[prop] = buildPropertyMethod(prop);\n    }\n  }\n};\n\nfunction _C2D2CanvasPixelArraySetup () {\n  const props = ['length']; // We'll just use this commonly used accessor name\n  C2D2CanvasPixelArray.prototype.item = function (value, value2) {\n    if (value2 === undefined) {\n      return this.parent[value];\n    }\n    this.parent[value] = value2;\n    return this;\n  };\n  //  even though not part of standard interface (not specified)\n  DelegateChain.addPropertyMethods(props, C2D2CanvasPixelArray);\n}\n\nfunction C2D2CanvasPixelArray (canvasPixelArrayObj) {\n  if (!C2D2CanvasPixelArray.prototype.length) {\n    _C2D2CanvasPixelArraySetup();\n  }\n  this.parent = this.array = this.pixelArray = canvasPixelArrayObj;\n}\n\nfunction _C2D2ImageDataSetup () {\n  const props = [\n      'width', 'height', 'resolution' // Todo: The latter is read-only\n    ],\n    getterMethods = ['data'];\n  DelegateChain.addGetterMethods(\n    getterMethods, C2D2ImageData, C2D2CanvasPixelArray, true\n  );\n  DelegateChain.addPropertyMethods(props, C2D2ImageData);\n}\n\nfunction C2D2ImageData (imageDataObj) {\n  if (!C2D2ImageData.prototype.width) {\n    _C2D2ImageDataSetup();\n  }\n  this.parent = this.imageData = imageDataObj;\n}\n\nfunction _C2D2GradientSetup () {\n  const methods = ['addColorStop'];\n  DelegateChain.addMethods(methods, C2D2Gradient);\n}\n\n// Partly opaque\nfunction C2D2Gradient (gradientObj) {\n  if (!C2D2Gradient.prototype.addColorStop) {\n    _C2D2GradientSetup();\n  }\n  this.parent = this.gradient = gradientObj;\n}\n\n// function _C2D2PatternSetup () {\n//      Fully opaque\n// }\n\n// Fully opaque\n// If never any benefits to wrapping (with chainable new methods),\n//  just avoid making this child class\nfunction C2D2Pattern (patternObj) {\n  // if (!C2D2Pattern.prototype.width) { // no known properties/methods\n  //    _C2D2PatternSetup();\n  // }\n  this.parent = this.pattern = patternObj;\n  // Just return the object for now, as appears there will be no need to wrap\n  return patternObj;\n}\n\nfunction _C2D2ContextSetup () {\n  // Predefined methods\n  const methods = [\n    'addHitRegion', 'arc', 'arcTo', 'beginPath',\n    'bezierCurveTo', 'clearRect',\n    'clip', 'closePath', 'commit', 'drawImage', 'drawSystemFocusRing',\n    'ellipse', 'fill', 'fillRect', 'fillText', 'getLineDash',\n    'lineTo', 'moveTo', 'quadraticCurveTo', 'rect', 'removeHitRegion',\n    'resetClip', 'resetTransform',\n    'restore', 'rotate', 'save', 'scale', 'scrollPathIntoView',\n    'setLineDash', 'setTransform',\n    'stroke', 'strokeRect', 'strokeText', 'transform', 'translate'\n  ]; // drawFocusRing not currently supported\n    // Todo: Implement these to be wrapped so can get and set data in\n    //   their own child chains\n    // Todo: `createPattern` is a wholly opaque object, so might need to\n    //    have child wrappers if implementing any known methods in the future\n  const imageDataGetterMethods = [\n    'createImageData', 'createImageDataHD', 'getImageData',\n    'getImageDataHD', 'putImageData', 'putImageDataHD'\n  ];\n  const gradientGetterMethods = [\n    'createLinearGradient', 'createRadialGradient'\n  ];\n    // Todo: createPattern to accept wrapped canvas element or context?\n  const patternGetterMethods = ['createPattern'];\n  // Do not return 'this' object since purpose is to get (and the\n  //  objects they create don't have more than one method to make it\n  //  desirable to chain, except for ImageData ones, moved to\n  //  `childGetterMethods`\n  const getterMethods = [\n    'drawCustomFocusRing', 'isPointInPath',\n    'isPointInStroke', 'measureText'\n  ]; // wrap `TextMetrics` of `measureText`?\n    // Predefined properties\n\n  // Todo: `fillStyle` and `strokeStyle` to return or be settable with\n  //  wrapped `CanvasGradient` or `CanvasPattern`, `currentTransform` with\n  //  wrapped `SVGMatrix`?\n  const props = [\n    'canvas', 'currentTransform', 'direction', 'fillStyle', 'font',\n    'globalAlpha', 'globalCompositeOperation', 'imageSmoothingEnabled',\n    'lineCap', 'lineDashOffset', 'lineJoin', 'lineWidth', 'miterLimit',\n    'shadowOffsetX', 'shadowOffsetY', 'shadowBlur', 'shadowColor',\n    'strokeStyle', 'textAlign', 'textBaseline'\n  ];\n\n  DelegateChain.addMethods(methods, C2D2Context);\n\n  DelegateChain.addGetterMethods(\n    imageDataGetterMethods, C2D2Context, C2D2ImageData\n  );\n  DelegateChain.addGetterMethods(\n    gradientGetterMethods, C2D2Context, C2D2Gradient\n  );\n  DelegateChain.addGetterMethods(\n    patternGetterMethods, C2D2Context, C2D2Pattern\n  );\n\n  DelegateChain.addGetterMethods(getterMethods, C2D2Context);\n\n  DelegateChain.addPropertyMethods(props, C2D2Context);\n}\n\nfunction c2d2Element (arr, opts) {\n  let el = opts;\n  const d = win.document || null;\n  const noArray = typeof arr !== 'object' || !arr.length;\n\n  if (noArray) {\n    el = opts = arr;\n    arr = [];\n  } else {\n    opts = opts || {};\n  }\n  const bNodeModule = opts && (opts.path || opts.fileStream);\n\n  let parent;\n  // Todo: deal with string w/h coords, number w/h coords\n  if (typeof opts === 'string') {\n    el = d.querySelector('#' + opts);\n  } else if (typeof opts === 'object' && bNodeModule) {\n    el = createCanvas();\n    const width = arr[0] || opts.width || opts.w;\n    const height = arr[1] || opts.height || opts.h;\n    if (width) {\n      el.width = width;\n    }\n    if (height) {\n      el.height = height;\n    }\n    const path = opts.fileStream || opts.path;\n    if (path) {\n      const out = fs.createWriteStream(path);\n      const stream = el.createPNGStream();\n      stream.on('data', (chunk) => {\n        out.write(chunk);\n      });\n      stream.on('end', () => {\n        out.end();\n      });\n    }\n  } else if (typeof opts === 'object' && !opts.nodeName) {\n    el = (d.createElementNS && d.documentElement.namespaceURI !== null)\n      ? d.createElementNS('http://www.w3.org/1999/xhtml', 'canvas')\n      : d.createElement('canvas');\n    if (opts.width || opts.w) {\n      el.setAttribute('width', opts.width || opts.w);\n    }\n    if (opts.height || opts.h) {\n      el.setAttribute('height', opts.height || opts.h);\n    }\n    if (opts.id) {\n      el.setAttribute('id', opts.id);\n    }\n    if (opts.style) { // Better to use a class instead\n      el.setAttribute('style', opts.style);\n    }\n    if (opts.innerHTML) { // For fallback display\n      el.innerHTML = opts.innerHTML;\n    }\n    if (opts.class || opts.className) {\n      el.setAttribute('class', opts.class || opts.className);\n    }\n    parent = opts.appendTo\n      ? typeof opts.appendTo === 'string'\n        ? d.querySelector('#' + opts.appendTo)\n        : opts.appendTo\n      : d.body;\n  } else if (opts === undefined) {\n    el = d.querySelector('canvas');\n  }\n\n  if (!noArray && el.setAttribute) {\n    el.setAttribute('width', arr[0]);\n    el.setAttribute('height', arr[1]);\n  }\n  if (parent) {\n    parent.append(el);\n  }\n\n  if (win.G_vmlCanvasManager) { // If using ExplorerCanvas to get IE support: http://code.google.com/p/explorercanvas/\n    el = win.G_vmlCanvasManager.initElement(el);\n  }\n  return el;\n}\n\n/**\n* @typedef {PlainObject} WidthHeight\n* @property {Float} 0\n* @property {Float} 1\n*/\n\n/**\n* Wraps `CanvasRenderingContext2D`.\n* @class\n* @todo Could make generic CanvasContext to accept \"type\" as a\n*  property when not '2d'\n* @param {WidthHeight} arr\n* @param {PlainObject} opts\n*/\nfunction C2D2Context (arr, opts) {\n  // eslint-disable-next-line no-restricted-syntax\n  if (!(this instanceof C2D2Context)) {\n    return new C2D2Context(arr, opts);\n  }\n\n  const el = this.canvas = c2d2Element(arr, opts);\n\n  this.context = this.parent = el.getContext('2d');\n  if (!C2D2Context.prototype.arc) {\n    _C2D2ContextSetup();\n  }\n  // Expose the c2d2Element properties (todo: could use\n  //  `Object.defineProperty` to ensure stayed in sync)\n  this.width = el.width;\n  this.height = el.height;\n  return this; // Satisfy Netbeans\n}\n\n// Expose the c2d2Element methods\n// Todo: Wrap this method's CanvasProxy return result?\n[\n  'transferControlToProxy',\n  'getContext', 'probablySupportsContext', 'supportsContext', 'setContext',\n  'toDataURL', 'toDataURLHD', 'toBlob', 'toBlobHD'\n].forEach(function (method) {\n  C2D2Context.prototype[method] = function (...args) {\n    return this.canvas[method](...args);\n  };\n});\n\nC2D2Context.addMethods = function (methodMap) {\n  Object.entries(methodMap).forEach(([methodName, method]) => {\n    C2D2Context.prototype[methodName] = buildContextMethods(method);\n  });\n};\n\n// Unlike addMethods, requires manually supplying 'this' at the end\nC2D2Context.extend = function (obj) { // Keeps constructor property in tact\n  Object.entries(obj).forEach(([propertyName, propertyValue]) => {\n    C2D2Context.prototype[propertyName] = propertyValue;\n  });\n};\n\n// EXTENSIONS\nC2D2Context.addMethods({\n  $line (...args) {\n    const [obj, close] = args;\n    let a = args;\n    if (obj && typeof obj === 'object' && !obj.length) {\n      if (obj.color) {\n        this.$lineColor(obj.color);\n      }\n      if (obj.width || obj.w) {\n        this.lineWidth(obj.width || obj.w);\n      }\n      if (obj.shadow || obj.$shadow) {\n        this.$shadow(obj.shadow);\n      }\n      a = [...(obj.coords || obj.xy || obj.path)];\n    }\n    this.beginPath().moveTo.apply(this, a[0]);\n    a.slice(1).forEach((aItem) => {\n      this.lineTo(...aItem);\n    });\n    if (close || obj.close) {\n      this.closePath();\n    }\n    this.stroke();\n  },\n  $fill (...args) {\n    const [obj] = args;\n    let a = args;\n    if (obj && typeof obj === 'object' && !obj.length) {\n      if (obj.color) {\n        this.$fillColor(obj.color);\n      }\n      if (obj.shadow || obj.$shadow) {\n        this.$shadow(obj.shadow);\n      }\n      a = [...(obj.coords || obj.xy || obj.path)];\n    }\n    if (a[0].length === 4) {\n      return this.$fillRect(...a);\n    }\n    this.beginPath().moveTo.apply(this, a[0]);\n    a.slice(1).forEach((aItem) => {\n      this.lineTo(...aItem);\n    });\n    this.fill();\n    return this;\n  },\n  $clear (...args) {\n    this.$clearRect(...args);\n    return this;\n  },\n  $fillRect (...args) {\n    const [x, y, w, h] = args;\n    if (x && typeof x === 'object' && x.length) {\n      for (const arg of args) {\n        this.$fillRect(...arg); // Allow array for coordinates\n      }\n      return this;\n    }\n    this.fillRect(x || 0, y || 0, w || this.width, h || this.height);\n    return this;\n  },\n  $clearRect (...args) {\n    const [x, y, w, h] = args;\n    if (x && typeof x === 'object' && x.length) {\n      for (const arg of args) {\n        this.$clearRect(...arg); // Allow array for coordinates\n      }\n      return this;\n    }\n    this.clearRect(x || 0, y || 0, w || this.width, h || this.height);\n    return this;\n  },\n\n  // $rect, $clip, $arcTo\n\n  $strokeRect (...args) {\n    const [x, y, w, h] = args;\n    if (x && typeof x === 'object' && x.length) {\n      for (const arg of args) {\n        // Allow array for coordinates\n        this.$strokeRect(...arg);\n      }\n      return this;\n    }\n    this.strokeRect(x || 0, y || 0, w || this.width, h || this.height);\n    return this;\n  },\n  $arc (...args) {\n    const [x, y, radius, startAngle, endAngle, anticlockwise] = args;\n    if (x && typeof x === 'object' && x.length) {\n      for (const arg of args) {\n        this.$arc(...arg); // Allow array for coordinates\n      }\n      return this;\n    }\n    this.arc(x, y, radius, startAngle, endAngle, anticlockwise);\n    return this;\n  },\n  $quadraticCurve (...args) {\n    this.$quadratic(...args);\n  },\n  $quadraticCurveTo (...args) {\n    this.$quadratic(...args);\n  },\n  $quadratic (...args) {\n    const [cp1x, cp1y, x, y] = args;\n    if (cp1x && typeof cp1x === 'object' && cp1x.length) {\n      for (const arg of args) {\n        this.$quadratic(...arg); // Allow array for coordinates\n      }\n      return this;\n    }\n    this.quadraticCurveTo(cp1x, cp1y, x, y);\n    return this;\n  },\n  $bezierCurve (...args) {\n    this.$bezier(...args);\n  },\n  $bezierCurveTo (...args) {\n    this.$bezier(...args);\n  },\n  $bezier (...args) {\n    const [cp1x, cp1y, cp2x, cp2y, x, y] = args;\n    if (cp1x && typeof cp1x === 'object' && cp1x.length) {\n      for (const arg of args) {\n        this.$bezier(...arg); // Allow array for coordinates\n      }\n      return this;\n    }\n    this.bezierCurveTo(cp1x, cp1y, cp2x, cp2y, x, y);\n    return this;\n  }\n});\nC2D2Context.extend({ // Don't auto-return 'this' object for these\n  $shadowColor (value) {\n    if (value === 'random') {\n      value = C2D2Context.randomColor();\n    }\n    return this.shadowColor(value);\n  },\n  $fillColor (value) { // getter or setter\n    if (value === 'random') {\n      value = C2D2Context.randomColor();\n    }\n    return this.fillStyle(value);\n  },\n  $lineColor (value) { // getter or setter\n    if (value === 'random') {\n      value = C2D2Context.randomColor();\n    }\n    return this.strokeStyle(value);\n  },\n  $imageData (...args) {\n    if (typeof args[0] === 'object' && args[1] !== undefined) {\n      this.putImageData(...args);\n      return this;\n    }\n    if (args[2] !== undefined) {\n      return this.getImageData(...args); // data (length), width, height\n    }\n    return this.createImageData(...args);\n  },\n  $shadowOffset (x, y) {\n    if (x === undefined) {\n      return [this.shadowOffsetX(), this.shadowOffsetY()];\n    }\n\n    if (typeof x === 'object' && !y && x.length) {\n      y = x[1];\n      x = x[0];\n    } else if (typeof x === 'string' && x.includes(', ')) {\n      ([x, y] = x.split(/\\s*,\\s*/u));\n    }\n    this.shadowOffsetX(x).shadowOffsetY(y);\n    return this;\n  },\n  $shadowBlur (...args) { // Just a place-holder, at least for now\n    this.shadowBlur(...args);\n  },\n  $shadowOffsetY (...args) { // Just a place-holder, at least for now\n    this.shadowOffsetY(...args);\n  },\n  $shadowOffsetX (...args) { // Just a place-holder, at least for now\n    this.shadowOffsetX(...args);\n  },\n  $shadow (sh) {\n    if (sh === undefined) { // Not super useful compared to native\n      return {\n        offset: this.$shadowOffset(), blur: this.shadowBlur(),\n        color: this.$shadowColor(),\n        offsetX: this.shadowOffsetX(), offsetY: this.shadowOffsetY()\n      };\n    }\n    Object.entries(sh).forEach(([att, shadowOffset]) => {\n      // Offer additional property to get the coords together\n      if (att === 'offset') {\n        this.$shadowOffset(shadowOffset);\n      } else {\n        this[\n          `$shadow${att.charAt(0).toUpperCase() + att.slice(1)}`\n        ](shadowOffset);\n      }\n    });\n    return this;\n  }\n});\n\nC2D2Context.randomNumber = function (min, max) {\n  min = min || 0;\n  max = max || 1;\n  return Math.floor(Math.random() * (max - min + 1)) + min;\n};\n\n// See also the individual methods which use this (allowing\n//  \"random\" as a \"color\" argument)\nC2D2Context.randomColor = function (r, g, b, rmax, gmax, bmax) {\n  r = r || 0;\n  g = g || 0;\n  b = b || 0;\n  rmax = rmax || 255;\n  gmax = gmax || 255;\n  bmax = bmax || 255;\n  const red = C2D2Context.randomNumber(r, rmax),\n    green = C2D2Context.randomNumber(g, gmax),\n    blue = C2D2Context.randomNumber(b, bmax);\n  return `rgb${red}, ${green}, ${blue})`;\n};\n\nfunction _getPropertyFromStyleSheet (ss, selectorText, propertyName) {\n  const rules = ss.cssRules || ss.rules; // Mozilla or IE\n  for (let j = 0, crl = rules.length; j < crl; j++) {\n    const rule = rules[j];\n    try {\n      if (rule.type === 1 && // CSSRule.STYLE_RULE\n                rule.selectorText === selectorText) {\n        return rule.style.getPropertyValue(propertyName);\n      }\n    } catch (err) { // IE\n      if (rule.selectorText === selectorText) {\n        propertyName = propertyName.replace(/-[a-z]/gu, String.prototype.toUpperCase);\n        return rule.style[propertyName];\n      }\n    }\n  }\n  return false;\n}\n\n/**\n* Useful for separation of concerns, detecting the CSS style rule for a\n* given class, id, or other selector and applying it as an argument to\n* a canvas method, so that the JavaScript does not need to be concerned\n* with secondary styling (of course the images it generates is a kind\n* of style).\n* @param {string} selectorText\n* @param {string} propertyName\n* @param {CSSStyleSheet} sheet\n* @returns {string}\n*/\nC2D2Context.getCSSPropertyValue = function (selectorText, propertyName, sheet) {\n  let ss, val;\n  if (sheet !== undefined) {\n    ss = document.styleSheets[sheet];\n    return _getPropertyFromStyleSheet(ss, selectorText, propertyName);\n  }\n  [...document.styleSheets].some((styleSheet) => {\n    val = _getPropertyFromStyleSheet(\n      styleSheet, selectorText, propertyName\n    );\n    return val;\n  });\n  return val;\n};\n\n// Attach classes for sake of extensibility (or utilization for canvasElement)\nC2D2Context.CanvasPixelArray = C2D2CanvasPixelArray;\nC2D2Context.ImageData = C2D2ImageData;\nC2D2Context.Gradient = C2D2Gradient;\nC2D2Context.Pattern = C2D2Pattern;\nC2D2Context.canvasElement = c2d2Element;\n\nexport default C2D2Context;\n"],"names":["fs","createCanvas","require","win","window","global","buildMethod","m","args","this","parent","buildGetterMethod","gm","methodFromProperty","WrapperClass","imageData","buildLiteralGetterMethod","buildPropertyMethod","p","value","undefined","DelegateChain","[object Object]","methods","clss","method","prototype","getterMethods","getterMethod","props","prop","C2D2CanvasPixelArray","canvasPixelArrayObj","length","item","value2","addPropertyMethods","array","pixelArray","C2D2ImageData","imageDataObj","width","addGetterMethods","C2D2Gradient","gradientObj","addColorStop","addMethods","gradient","C2D2Pattern","patternObj","pattern","c2d2Element","arr","opts","el","d","document","noArray","bNodeModule","path","fileStream","querySelector","w","height","h","out","createWriteStream","stream","createPNGStream","on","chunk","write","end","nodeName","createElementNS","documentElement","namespaceURI","createElement","setAttribute","id","style","innerHTML","class","className","appendTo","body","append","G_vmlCanvasManager","initElement","C2D2Context","canvas","context","getContext","arc","_getPropertyFromStyleSheet","ss","selectorText","propertyName","rules","cssRules","j","crl","rule","type","getPropertyValue","err","replace","String","toUpperCase","forEach","methodMap","Object","entries","methodName","apply","buildContextMethods","extend","obj","propertyValue","close","a","color","$lineColor","lineWidth","shadow","$shadow","coords","xy","beginPath","moveTo","slice","aItem","lineTo","closePath","stroke","$fillColor","$fillRect","fill","$clearRect","x","y","arg","fillRect","clearRect","$strokeRect","strokeRect","radius","startAngle","endAngle","anticlockwise","$arc","$quadratic","cp1x","cp1y","quadraticCurveTo","$bezier","cp2x","cp2y","bezierCurveTo","randomColor","shadowColor","fillStyle","strokeStyle","putImageData","getImageData","createImageData","shadowOffsetX","shadowOffsetY","includes","split","shadowBlur","sh","offset","$shadowOffset","blur","$shadowColor","offsetX","offsetY","att","shadowOffset","charAt","randomNumber","min","max","Math","floor","random","r","g","b","rmax","gmax","bmax","getCSSPropertyValue","sheet","val","styleSheets","some","styleSheet","CanvasPixelArray","ImageData","Gradient","Pattern","canvasElement"],"mappings":"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"}