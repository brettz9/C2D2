{"version":3,"file":"c2d2-browser.min.js","sources":["../src/c2d2.js","../src/c2d2-browser.js"],"sourcesContent":["/**\n* @todo Resume ensuring properties/methods are added and any todos noted\n* for potential to accept specific arguments as wrapped objects or\n* return wrapped items: {@link http://www.whatwg.org/specs/web-apps/current-work/multipage/the-canvas-element.html#dfnReturnLink-0}\n* @todo Add tests, including for browser and Node\n*/\n\n// Adds NodeJS support, and exports interface to modules\n//   that require this module\n// This should not be needed by Node\nlet win;\n\nfunction buildMethod (m) {\n  return function (...args) {\n    this.parent[m](...args);\n    return this;\n  };\n}\nfunction buildGetterMethod (gm, methodFromProperty, WrapperClass) {\n  return function (...args) {\n    const imageData = args[0];\n    if (\n      gm === 'putImageData' && typeof imageData === 'object' &&\n            imageData.imageData\n    ) { // Todo: Hackish check for taking regular ImageData object\n      args[0] = imageData.imageData;\n    }\n    if (methodFromProperty) {\n      return new WrapperClass(this.parent[gm]);\n    }\n    return new WrapperClass(this.parent[gm](...args));\n  };\n}\nfunction buildLiteralGetterMethod (gm) {\n  return function (...args) {\n    return this.parent[gm](...args);\n  };\n}\nfunction buildPropertyMethod (p) {\n  return function (value) {\n    if (value === undefined) {\n      return this.parent[p];\n    }\n    this.parent[p] = value;\n    return this;\n  };\n}\nfunction buildContextMethods (method) {\n  return function (...args) {\n    method.apply(this, args);\n    return this;\n  };\n}\n// Todo: Wrap up any specific methods or properties which might be\n//   used on the opaque pattern and gradient child objects, if ever\n//   exposed, so that these can be properly wrapped and made chainable.\nconst DelegateChain = {\n  addMethods (methods, clss) {\n    for (const method of methods) {\n      clss.prototype[method] = buildMethod(method);\n    }\n  },\n  addGetterMethods (getterMethods, clss, WrapperClass, methodFromProperty) {\n    for (const getterMethod of getterMethods) {\n      clss.prototype[getterMethod] = WrapperClass\n        ? buildGetterMethod(\n          getterMethod, methodFromProperty, WrapperClass\n        )\n        // For those which return a literal\n        : buildLiteralGetterMethod(\n          getterMethod\n        );\n    }\n  },\n  addPropertyMethods (props, clss) {\n    for (const prop of props) {\n      clss.prototype[prop] = buildPropertyMethod(prop);\n    }\n  }\n};\n\nfunction _C2D2CanvasPixelArraySetup () {\n  const props = ['length']; // We'll just use this commonly used accessor name\n  C2D2CanvasPixelArray.prototype.item = function (value, value2) {\n    if (value2 === undefined) {\n      return this.parent[value];\n    }\n    this.parent[value] = value2;\n    return this;\n  };\n  //  even though not part of standard interface (not specified)\n  DelegateChain.addPropertyMethods(props, C2D2CanvasPixelArray);\n}\n\nfunction C2D2CanvasPixelArray (canvasPixelArrayObj) {\n  if (!C2D2CanvasPixelArray.prototype.length) {\n    _C2D2CanvasPixelArraySetup();\n  }\n  this.parent = this.array = this.pixelArray = canvasPixelArrayObj;\n}\n\nfunction _C2D2ImageDataSetup () {\n  const props = [\n      'width', 'height', 'resolution' // Todo: The latter is read-only\n    ],\n    getterMethods = ['data'];\n  DelegateChain.addGetterMethods(\n    getterMethods, C2D2ImageData, C2D2CanvasPixelArray, true\n  );\n  DelegateChain.addPropertyMethods(props, C2D2ImageData);\n}\n\nfunction C2D2ImageData (imageDataObj) {\n  if (!C2D2ImageData.prototype.width) {\n    _C2D2ImageDataSetup();\n  }\n  this.parent = this.imageData = imageDataObj;\n}\n\nfunction _C2D2GradientSetup () {\n  const methods = ['addColorStop'];\n  DelegateChain.addMethods(methods, C2D2Gradient);\n}\n\n// Partly opaque\nfunction C2D2Gradient (gradientObj) {\n  if (!C2D2Gradient.prototype.addColorStop) {\n    _C2D2GradientSetup();\n  }\n  this.parent = this.gradient = gradientObj;\n}\n\n// function _C2D2PatternSetup () {\n//      Fully opaque\n// }\n\n// Fully opaque\n// If never any benefits to wrapping (with chainable new methods),\n//  just avoid making this child class\nfunction C2D2Pattern (patternObj) {\n  // if (!C2D2Pattern.prototype.width) { // no known properties/methods\n  //    _C2D2PatternSetup();\n  // }\n  this.parent = this.pattern = patternObj;\n  // Just return the object for now, as appears there will be no need to wrap\n  return patternObj;\n}\n\nfunction _C2D2ContextSetup () {\n  // Predefined methods\n  const methods = [\n    'addHitRegion', 'arc', 'arcTo', 'beginPath',\n    'bezierCurveTo', 'clearRect',\n    'clip', 'closePath', 'commit', 'drawImage', 'drawSystemFocusRing',\n    'ellipse', 'fill', 'fillRect', 'fillText', 'getLineDash',\n    'lineTo', 'moveTo', 'quadraticCurveTo', 'rect', 'removeHitRegion',\n    'resetClip', 'resetTransform',\n    'restore', 'rotate', 'save', 'scale', 'scrollPathIntoView',\n    'setLineDash', 'setTransform',\n    'stroke', 'strokeRect', 'strokeText', 'transform', 'translate'\n  ]; // drawFocusRing not currently supported\n    // Todo: Implement these to be wrapped so can get and set data in\n    //   their own child chains\n    // Todo: `createPattern` is a wholly opaque object, so might need to\n    //    have child wrappers if implementing any known methods in the future\n  const imageDataGetterMethods = [\n    'createImageData', 'createImageDataHD', 'getImageData',\n    'getImageDataHD', 'putImageData', 'putImageDataHD'\n  ];\n  const gradientGetterMethods = [\n    'createLinearGradient', 'createRadialGradient'\n  ];\n    // Todo: createPattern to accept wrapped canvas element or context?\n  const patternGetterMethods = ['createPattern'];\n  // Do not return 'this' object since purpose is to get (and the\n  //  objects they create don't have more than one method to make it\n  //  desirable to chain, except for ImageData ones, moved to\n  //  `childGetterMethods`\n  const getterMethods = [\n    'drawCustomFocusRing', 'isPointInPath',\n    'isPointInStroke', 'measureText'\n  ]; // wrap `TextMetrics` of `measureText`?\n    // Predefined properties\n\n  // Todo: `fillStyle` and `strokeStyle` to return or be settable with\n  //  wrapped `CanvasGradient` or `CanvasPattern`, `currentTransform` with\n  //  wrapped `SVGMatrix`?\n  const props = [\n    'canvas', 'currentTransform', 'direction', 'fillStyle', 'font',\n    'globalAlpha', 'globalCompositeOperation', 'imageSmoothingEnabled',\n    'lineCap', 'lineDashOffset', 'lineJoin', 'lineWidth', 'miterLimit',\n    'shadowOffsetX', 'shadowOffsetY', 'shadowBlur', 'shadowColor',\n    'strokeStyle', 'textAlign', 'textBaseline'\n  ];\n\n  DelegateChain.addMethods(methods, C2D2Context);\n\n  DelegateChain.addGetterMethods(\n    imageDataGetterMethods, C2D2Context, C2D2ImageData\n  );\n  DelegateChain.addGetterMethods(\n    gradientGetterMethods, C2D2Context, C2D2Gradient\n  );\n  DelegateChain.addGetterMethods(\n    patternGetterMethods, C2D2Context, C2D2Pattern\n  );\n\n  DelegateChain.addGetterMethods(getterMethods, C2D2Context);\n\n  DelegateChain.addPropertyMethods(props, C2D2Context);\n}\n\nfunction c2d2Element (arr, opts) {\n  let el = opts;\n  const d = win.document || null;\n  const noArray = typeof arr !== 'object' || !arr.length;\n\n  if (noArray) {\n    el = opts = arr;\n    arr = [];\n  } else {\n    opts = opts || {};\n  }\n  const bNodeModule = opts && (opts.path || opts.fileStream);\n\n  let parent;\n  // Todo: deal with string w/h coords, number w/h coords\n  if (typeof opts === 'string') {\n    el = d.querySelector('#' + opts);\n  } else if (typeof opts === 'object' && bNodeModule) {\n    const width = arr[0] || opts.width || opts.w;\n    const height = arr[1] || opts.height || opts.h;\n    const path = opts.fileStream || opts.path;\n    if (path) {\n      writeToDisk({path, width, height});\n    }\n  } else if (typeof opts === 'object' && !opts.nodeName) {\n    el = (d.createElementNS && d.documentElement.namespaceURI !== null)\n      ? d.createElementNS('http://www.w3.org/1999/xhtml', 'canvas')\n      : d.createElement('canvas');\n    if (opts.width || opts.w) {\n      el.setAttribute('width', opts.width || opts.w);\n    }\n    if (opts.height || opts.h) {\n      el.setAttribute('height', opts.height || opts.h);\n    }\n    if (opts.id) {\n      el.setAttribute('id', opts.id);\n    }\n    if (opts.style) { // Better to use a class instead\n      el.setAttribute('style', opts.style);\n    }\n    if (opts.class || opts.className) {\n      el.setAttribute('class', opts.class || opts.className);\n    }\n    parent = opts.appendTo\n      ? typeof opts.appendTo === 'string'\n        ? d.querySelector('#' + opts.appendTo)\n        : opts.appendTo\n      : d.body;\n  } else if (opts === undefined) {\n    el = d.querySelector('canvas');\n  }\n\n  if (!noArray && el.setAttribute) {\n    el.setAttribute('width', arr[0]);\n    el.setAttribute('height', arr[1]);\n  }\n  if (parent) {\n    parent.append(el);\n  }\n\n  if (win.G_vmlCanvasManager) { // If using ExplorerCanvas to get IE support: http://code.google.com/p/explorercanvas/\n    el = win.G_vmlCanvasManager.initElement(el);\n  }\n  return el;\n}\n\n/**\n* @typedef {PlainObject} WidthHeight\n* @property {Float} 0\n* @property {Float} 1\n*/\n\n/**\n* Wraps `CanvasRenderingContext2D`.\n* @class\n* @todo Could make generic CanvasContext to accept \"type\" as a\n*  property when not '2d'\n* @param {WidthHeight} arr\n* @param {PlainObject} opts\n*/\nfunction C2D2Context (arr, opts) {\n  // eslint-disable-next-line no-restricted-syntax -- Support old API\n  if (!(this instanceof C2D2Context)) {\n    return new C2D2Context(arr, opts);\n  }\n\n  const el = this.canvas = c2d2Element(arr, opts);\n\n  this.context = this.parent = el.getContext('2d');\n  if (!C2D2Context.prototype.arc) {\n    _C2D2ContextSetup();\n  }\n  // Expose the c2d2Element properties (todo: could use\n  //  `Object.defineProperty` to ensure stayed in sync)\n  this.width = el.width;\n  this.height = el.height;\n}\n\n// Expose the c2d2Element methods\n// Todo: Wrap this method's CanvasProxy return result?\n[\n  'transferControlToProxy',\n  'getContext', 'probablySupportsContext', 'supportsContext', 'setContext',\n  'toDataURL', 'toDataURLHD', 'toBlob', 'toBlobHD'\n].forEach(function (method) {\n  C2D2Context.prototype[method] = function (...args) {\n    return this.canvas[method](...args);\n  };\n});\n\nC2D2Context.addMethods = function (methodMap) {\n  Object.entries(methodMap).forEach(([methodName, method]) => {\n    C2D2Context.prototype[methodName] = buildContextMethods(method);\n  });\n};\n\n// Unlike addMethods, requires manually supplying 'this' at the end\nC2D2Context.extend = function (obj) { // Keeps constructor property in tact\n  Object.entries(obj).forEach(([propertyName, propertyValue]) => {\n    C2D2Context.prototype[propertyName] = propertyValue;\n  });\n};\n\n// EXTENSIONS\nC2D2Context.addMethods({\n  $line (...args) {\n    const [obj, close] = args;\n    let a = args;\n    if (obj && typeof obj === 'object' && !obj.length) {\n      if (obj.color) {\n        this.$lineColor(obj.color);\n      }\n      if (obj.width || obj.w) {\n        this.lineWidth(obj.width || obj.w);\n      }\n      if (obj.shadow || obj.$shadow) {\n        this.$shadow(obj.shadow);\n      }\n      a = [...(obj.coords || obj.xy || obj.path)];\n    }\n    this.beginPath().moveTo.apply(this, a[0]);\n    a.slice(1).forEach((aItem) => {\n      this.lineTo(...aItem);\n    });\n    if (close || obj.close) {\n      this.closePath();\n    }\n    this.stroke();\n  },\n  $fill (...args) {\n    const [obj] = args;\n    let a = args;\n    if (obj && typeof obj === 'object' && !obj.length) {\n      if (obj.color) {\n        this.$fillColor(obj.color);\n      }\n      if (obj.shadow || obj.$shadow) {\n        this.$shadow(obj.shadow);\n      }\n      a = [...(obj.coords || obj.xy || obj.path)];\n    }\n    if (a[0].length === 4) {\n      return this.$fillRect(...a);\n    }\n    this.beginPath().moveTo.apply(this, a[0]);\n    a.slice(1).forEach((aItem) => {\n      this.lineTo(...aItem);\n    });\n    this.fill();\n    return this;\n  },\n  $clear (...args) {\n    this.$clearRect(...args);\n    return this;\n  },\n  $fillRect (...args) {\n    const [x, y, w, h] = args;\n    if (x && typeof x === 'object' && x.length) {\n      for (const arg of args) {\n        this.$fillRect(...arg); // Allow array for coordinates\n      }\n      return this;\n    }\n    this.fillRect(x || 0, y || 0, w || this.width, h || this.height);\n    return this;\n  },\n  $clearRect (...args) {\n    const [x, y, w, h] = args;\n    if (x && typeof x === 'object' && x.length) {\n      for (const arg of args) {\n        this.$clearRect(...arg); // Allow array for coordinates\n      }\n      return this;\n    }\n    this.clearRect(x || 0, y || 0, w || this.width, h || this.height);\n    return this;\n  },\n\n  // $rect, $clip, $arcTo\n\n  $strokeRect (...args) {\n    const [x, y, w, h] = args;\n    if (x && typeof x === 'object' && x.length) {\n      for (const arg of args) {\n        // Allow array for coordinates\n        this.$strokeRect(...arg);\n      }\n      return this;\n    }\n    this.strokeRect(x || 0, y || 0, w || this.width, h || this.height);\n    return this;\n  },\n  $arc (...args) {\n    const [x, y, radius, startAngle, endAngle, anticlockwise] = args;\n    if (x && typeof x === 'object' && x.length) {\n      for (const arg of args) {\n        this.$arc(...arg); // Allow array for coordinates\n      }\n      return this;\n    }\n    this.arc(x, y, radius, startAngle, endAngle, anticlockwise);\n    return this;\n  },\n  $quadraticCurve (...args) {\n    this.$quadratic(...args);\n  },\n  $quadraticCurveTo (...args) {\n    this.$quadratic(...args);\n  },\n  $quadratic (...args) {\n    const [cp1x, cp1y, x, y] = args;\n    if (cp1x && typeof cp1x === 'object' && cp1x.length) {\n      for (const arg of args) {\n        this.$quadratic(...arg); // Allow array for coordinates\n      }\n      return this;\n    }\n    this.quadraticCurveTo(cp1x, cp1y, x, y);\n    return this;\n  },\n  $bezierCurve (...args) {\n    this.$bezier(...args);\n  },\n  $bezierCurveTo (...args) {\n    this.$bezier(...args);\n  },\n  $bezier (...args) {\n    const [cp1x, cp1y, cp2x, cp2y, x, y] = args;\n    if (cp1x && typeof cp1x === 'object' && cp1x.length) {\n      for (const arg of args) {\n        this.$bezier(...arg); // Allow array for coordinates\n      }\n      return this;\n    }\n    this.bezierCurveTo(cp1x, cp1y, cp2x, cp2y, x, y);\n    return this;\n  }\n});\nC2D2Context.extend({ // Don't auto-return 'this' object for these\n  $shadowColor (value) {\n    if (value === 'random') {\n      value = C2D2Context.randomColor();\n    }\n    return this.shadowColor(value);\n  },\n  $fillColor (value) { // getter or setter\n    if (value === 'random') {\n      value = C2D2Context.randomColor();\n    }\n    return this.fillStyle(value);\n  },\n  $lineColor (value) { // getter or setter\n    if (value === 'random') {\n      value = C2D2Context.randomColor();\n    }\n    return this.strokeStyle(value);\n  },\n  $imageData (...args) {\n    if (typeof args[0] === 'object' && args[1] !== undefined) {\n      this.putImageData(...args);\n      return this;\n    }\n    if (args[2] !== undefined) {\n      return this.getImageData(...args); // data (length), width, height\n    }\n    return this.createImageData(...args);\n  },\n  $shadowOffset (x, y) {\n    if (x === undefined) {\n      return [this.shadowOffsetX(), this.shadowOffsetY()];\n    }\n\n    if (typeof x === 'object' && !y && x.length) {\n      y = x[1];\n      x = x[0];\n    } else if (typeof x === 'string' && x.includes(', ')) {\n      ([x, y] = x.split(/\\s*,\\s*/u));\n    }\n    this.shadowOffsetX(x).shadowOffsetY(y);\n    return this;\n  },\n  $shadowBlur (...args) { // Just a place-holder, at least for now\n    this.shadowBlur(...args);\n  },\n  $shadowOffsetY (...args) { // Just a place-holder, at least for now\n    this.shadowOffsetY(...args);\n  },\n  $shadowOffsetX (...args) { // Just a place-holder, at least for now\n    this.shadowOffsetX(...args);\n  },\n  $shadow (sh) {\n    if (sh === undefined) { // Not super useful compared to native\n      return {\n        offset: this.$shadowOffset(), blur: this.shadowBlur(),\n        color: this.$shadowColor(),\n        offsetX: this.shadowOffsetX(), offsetY: this.shadowOffsetY()\n      };\n    }\n    Object.entries(sh).forEach(([att, shadowOffset]) => {\n      // Offer additional property to get the coords together\n      if (att === 'offset') {\n        this.$shadowOffset(shadowOffset);\n      } else {\n        this[\n          `$shadow${att.charAt(0).toUpperCase() + att.slice(1)}`\n        ](shadowOffset);\n      }\n    });\n    return this;\n  }\n});\n\nC2D2Context.randomNumber = function (min = 0, max = 1) {\n  return Math.floor(Math.random() * (max - min + 1)) + min;\n};\n\n// See also the individual methods which use this (allowing\n//  \"random\" as a \"color\" argument)\nC2D2Context.randomColor = function (\n  r = 0, g = 0, b = 0, rmax = 255, gmax = 255, bmax = 255\n) {\n  const red = C2D2Context.randomNumber(r, rmax),\n    green = C2D2Context.randomNumber(g, gmax),\n    blue = C2D2Context.randomNumber(b, bmax);\n  return `rgb${red}, ${green}, ${blue})`;\n};\n\nfunction _getPropertyFromStyleSheet (ss, selectorText, propertyName) {\n  const rules = ss.cssRules || ss.rules; // Mozilla or IE\n  for (let j = 0, crl = rules.length; j < crl; j++) {\n    const rule = rules[j];\n    try {\n      if (rule.type === 1 && // CSSRule.STYLE_RULE\n                rule.selectorText === selectorText) {\n        return rule.style.getPropertyValue(propertyName);\n      }\n    } catch (err) { // IE\n      if (rule.selectorText === selectorText) {\n        propertyName = propertyName.replaceAll(/-[a-z]/gu, String.prototype.toUpperCase);\n        return rule.style[propertyName];\n      }\n    }\n  }\n  return false;\n}\n\n/**\n* Useful for separation of concerns, detecting the CSS style rule for a\n* given class, id, or other selector and applying it as an argument to\n* a canvas method, so that the JavaScript does not need to be concerned\n* with secondary styling (of course the images it generates is a kind\n* of style).\n* @param {string} selectorText\n* @param {string} propertyName\n* @param {CSSStyleSheet} sheet\n* @returns {string}\n*/\nC2D2Context.getCSSPropertyValue = function (selectorText, propertyName, sheet) {\n  let ss, val;\n  if (sheet !== undefined) {\n    ss = document.styleSheets[sheet];\n    return _getPropertyFromStyleSheet(ss, selectorText, propertyName);\n  }\n  [...document.styleSheets].some((styleSheet) => {\n    val = _getPropertyFromStyleSheet(\n      styleSheet, selectorText, propertyName\n    );\n    return val;\n  });\n  return val;\n};\n\n// Attach classes for sake of extensibility (or utilization for canvasElement)\nC2D2Context.CanvasPixelArray = C2D2CanvasPixelArray;\nC2D2Context.ImageData = C2D2ImageData;\nC2D2Context.Gradient = C2D2Gradient;\nC2D2Context.Pattern = C2D2Pattern;\nC2D2Context.canvasElement = c2d2Element;\n\nlet writeToDisk;\nC2D2Context.setWriteToDisk = (w2d) => {\n  writeToDisk = w2d;\n};\nC2D2Context.setWindow = (w) => {\n  win = w;\n};\n\nexport default C2D2Context;\n","import c2d2 from './c2d2.js';\n\nc2d2.setWindow(window);\n\nexport default c2d2;\n"],"names":["win","buildMethod","m","args","this","parent","buildGetterMethod","gm","methodFromProperty","WrapperClass","imageData","buildLiteralGetterMethod","buildPropertyMethod","p","value","undefined","DelegateChain","addMethods","methods","clss","method","prototype","addGetterMethods","getterMethods","getterMethod","addPropertyMethods","props","prop","C2D2CanvasPixelArray","canvasPixelArrayObj","length","item","value2","array","pixelArray","C2D2ImageData","imageDataObj","width","C2D2Gradient","gradientObj","addColorStop","gradient","C2D2Pattern","patternObj","pattern","c2d2Element","arr","opts","el","d","document","noArray","bNodeModule","path","fileStream","querySelector","w","height","h","writeToDisk","nodeName","createElementNS","documentElement","namespaceURI","createElement","setAttribute","id","style","class","className","appendTo","body","append","G_vmlCanvasManager","initElement","C2D2Context","canvas","context","getContext","arc","_getPropertyFromStyleSheet","ss","selectorText","propertyName","rules","cssRules","j","crl","rule","type","getPropertyValue","err","replaceAll","String","toUpperCase","forEach","methodMap","Object","entries","methodName","apply","buildContextMethods","extend","obj","propertyValue","$line","close","a","color","$lineColor","lineWidth","shadow","$shadow","coords","xy","beginPath","moveTo","slice","aItem","lineTo","closePath","stroke","$fill","$fillColor","$fillRect","fill","$clear","$clearRect","x","y","arg","fillRect","clearRect","$strokeRect","strokeRect","$arc","radius","startAngle","endAngle","anticlockwise","$quadraticCurve","$quadratic","$quadraticCurveTo","cp1x","cp1y","quadraticCurveTo","$bezierCurve","$bezier","$bezierCurveTo","cp2x","cp2y","bezierCurveTo","$shadowColor","randomColor","shadowColor","fillStyle","strokeStyle","$imageData","putImageData","getImageData","createImageData","$shadowOffset","shadowOffsetX","shadowOffsetY","includes","split","$shadowBlur","shadowBlur","$shadowOffsetY","$shadowOffsetX","sh","offset","blur","offsetX","offsetY","att","shadowOffset","charAt","randomNumber","min","max","Math","floor","random","r","g","b","rmax","gmax","bmax","getCSSPropertyValue","sheet","val","styleSheets","some","styleSheet","CanvasPixelArray","ImageData","Gradient","Pattern","canvasElement","setWriteToDisk","w2d","setWindow","c2d2","window"],"mappings":"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"}